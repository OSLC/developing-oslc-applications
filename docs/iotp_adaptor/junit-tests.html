<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>JUnit Tests</title><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="anonymous"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="stylesheet" href="https://oslc.github.io/developing-oslc-applications/css/oslc.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/solid.css" integrity="sha384-QokYePQSOwpBDuhlHOsX0ymF6R/vLk/UQVz3WHa6wygxI5oGTmDTv8wahFOSspdm" crossorigin="anonymous"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/fontawesome.css" integrity="sha384-vd1e11sR28tEK9YANUtpIOdjGW14pS87bUBuOIoBILVWLFnS+MCX9T6MMf0VdPGq" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600;1,700&amp;family=Overpass+Mono&amp;display=swap" crossorigin="anonymous"><script src="https://oslc.github.io/developing-oslc-applications/js/lib/modernizr.js"></script><link rel="stylesheet" href="https://oslc.github.io/developing-oslc-applications/css/oslc_enhanced.css"></head><body><header class="header"><div class="flag"><div class="image"><button title="Main menu" role="button" aria-label="Toggle Navigation" data-toggle-class="primary-nav-is-open" data-toggle-target="body" class="navburger mustard-only"><span class="navburger-line top"></span><span class="navburger-line middle"></span><span class="navburger-line bottom"></span></button></div><div class="body"><a href="https://oslc.github.io/developing-oslc-applications/" class="flag image-link"><div class="image"><img src="https://oslc.github.io/developing-oslc-applications/img/logo-new-mobile.png" class="logo-img"></div><div class="body"><span class="logo-text"><abbr title="Open Services for Lifecycle Collaboration" class="oslc-name">OSLC</abbr><br><span class="project-name">Developer Guide</span></span></div></a></div></div></header><div class="sticky-footer-body off-canvas-wrap"><nav class="nav"><div class="menu primary"><div class="item desk-up"><a href="https://oslc.github.io/developing-oslc-applications/" class="image-link"><img src="https://oslc.github.io/developing-oslc-applications/img/logo-new-big.png" width="100" height="100" class="logo"><span class="logo-text"><abbr title="Open Services for Lifecycle Collaboration" class="oslc-name">OSLC</abbr><span class="project-name">Developer Guide</span></span></a></div><ul class="items"><li role="presentation" class="item"><a href="../iotp-adaptor-sample.html"><i class="fas fa-level-up-alt"></i> One level up</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/developer-guide.html">Developer Guide</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/environment-setup.html">eclipse environment setup</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/toolchain-model.html">The toolchain model</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/code-generator.html">Generating the server code</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/exploring-the-code.html">Exploring the generated code</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/ssl-support.html">https and SSL support</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/authentication.html">Authentication</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/rootservices.html">Creating the rootservices document</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/consumer-friend.html">Connecting Servers</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/artifact-container-associations.html">Artifact Container Associations</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/dialogs.html">Updating generated dialogs</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/implement-domain-class.html">Implementing a Domain Class</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/trs-provider.html">Implementing a TRS Provider</a></li><li role="presentation" class="item current"><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/junit-tests.html">JUnit Tests</a></li></ul><div><iframe src="https://duckduckgo.com/search.html?width=220&site=oslc.github.io/developing-oslc-applications/&prefill=Search DuckDuckGo&kn=1" style="overflow:hidden;margin:0 0 0 13px;padding:0;width:305px;height:40px;" frameborder="0"></iframe></div></div></nav><main class="main"><div class="card"><header class="header"><h1 class="title">JUnit Tests</h1></header><section class="content"><div class="copy"><h1>JUnit Tests</h1><p>Sample JUnit tests are provided to test the CRUD operations on the IoT Platform DeviceType resource in <code>com.ibm.oslc.adaptor.tests.iotp-adaptorTests.java</code>. This can be used as a pattern to develop tests for other resources as they are supported.</p>
<p>There are a few considerations to address in implementing these JUnit test cases that are covered in this section. </p>
<p>There are also opportunities to introduce other automated tests for the generated Web UI, especially for the creation and selection dialogs, and the small and large preview dialogs. These tests are currently done manually. </p>
<h2>OslcClient login</h2><p>The OSLC4J OslcClient provides OAuth and Jazz FORM based login, and these are what is supported by the jazz.net apps. But does not directly support pre-emptive login with user credentials which is required by the IBM Watson IoT Platform. There&#39;s no constructor <code>OslcClient(String userId, String password)</code>. These a straightforward work around demonstrated in the following code fragment (which comes from C4IoTConnectorTests.java). The workaround is to construct a simple OslcClient, and then add an Authorization header that will be included on all requests.</p>
<pre><code>        try {
            client = new OslcClient();
            // Add a receptor to set the Authorization header as a default 
            // header for all requests
            Header header = new BasicHeader(HttpHeaders.AUTHORIZATION,  
                &quot;Basic &quot;+Base64.encode((userId+&quot;:&quot;+password).getBytes()));
            List&lt;Header&gt; headers = new ArrayList&lt;Header&gt;();
            headers.add(header);
            RequestDefaultHeaders defaultHeaders = new RequestDefaultHeaders(headers);
            ((DefaultHttpClient)client.getHttpClient()).addRequestInterceptor(defaultHeaders);

            String catalogUrl = serverUrl + &quot;/services/catalog/singleton&quot;;
            
            String orgTitle = &quot;IoT Platform Service Provider: &quot;+orgId+&quot;(/&quot;+orgId+&quot;)&quot;;
            String serviceProviderUrl = client.lookupServiceProviderUrl(catalogUrl, orgTitle);

            queryCapability = client.lookupQueryCapability(serviceProviderUrl,
                    Oslc_iotDomainConstants.IOT_PLATFORM_NAMSPACE, Oslc_iotDomainConstants.DEVICETYPE_TYPE);

            creationFactory = client.lookupCreationFactory(serviceProviderUrl,
                    Oslc_iotDomainConstants.IOT_PLATFORM_NAMSPACE, Oslc_iotDomainConstants.DEVICETYPE_TYPE);
        } catch (Exception e) {
            e.printStackTrace();
        }
</code></pre>
<p>At some point, this simple approach should be migrated into the eclipse/Lyo Java client API. </p>
<p>You will probably get deprecated code warnings in this code because OSLC4J OslcClient needs to be updated to use the updated HttpClient</p>
<h2>A Typical Resource Test Case</h2><p>The tests for CRUD operations on resources follow a typical pattern:</p>
<ol>
<li>Create a new resource</li>
<li>Read the resource you just created</li>
<li>Update the resource</li>
<li>Read back the resource and make sure the update was applied</li>
<li>Delete the created resource</li>
</ol>
<p>This test pattern doesn&#39;t require much prior setup, and leaves the data source unchanged after it runs successfully.</p>
<p>Here&#39;s the implementation of this typical pattern on Watson IoT Platform DeviceType:</p>
<pre><code>    @Test
    public void testDeviceType() throws Exception {
        String uri = creationFactory.replace(&quot;devicetype&quot;, &quot;iotDeviceTypes&quot;) + &quot;/TestDeviceType&quot;;

        // Create
        DeviceType deviceType = new DeviceType(new URI(uri));
        deviceType.setIdentifier(&quot;TestDeviceType&quot;);
        deviceType.setTitle(&quot;TestDeviceType&quot;);
        // TODO: add values to all the supported properties
        deviceType.setDescription(&quot;This is a test device that will be deleted&quot;);
        ClientResponse response = client.createResource(creationFactory, deviceType, OSLCConstants.CT_RDF);
        assertEquals(response.getStatusCode(), HttpStatus.SC_CREATED);
        logger.info(&quot;Created DeviceType: &quot; + deviceType.getTitle());
        response.consumeContent();

        // Read
        deviceType = client.getResource(uri).getEntity(DeviceType.class);
        assertEquals(&quot;TestDeviceType&quot;, deviceType.getIdentifier());
        // TODO: Check all the read properties to be sure they are what was set when the resource was created
        logger.info(&quot;Read DeviceType: &quot; + deviceType.getTitle());
        response.consumeContent();

        // Update
        deviceType.setDescription(&quot;This is the updated description&quot;);
        // TODO: make changes to more of the properties
        response = client.updateResource(uri, deviceType, OSLCConstants.CT_RDF);
        assertEquals(response.getStatusCode(), HttpStatus.SC_OK);
        logger.info(&quot;Updated DeviceType: &quot; + deviceType.getTitle());
        response.consumeContent();
        
        // Read back the DeviceType that was just updated
        deviceType = client.getResource(uri).getEntity(DeviceType.class);
        // TODO: Check that all of the updated properties have the expected values
        assertEquals(deviceType.getDescription(), &quot;This is the updated description&quot;);
        logger.info(&quot;Read updated DeviceType: &quot; + deviceType.getTitle());
        response.consumeContent();

        // Delete
        response = client.deleteResource(uri);
        assertEquals(response.getStatusCode(), HttpStatus.SC_OK);
        logger.info(&quot;Deleted DeviceType: &quot; + uri);
        response.consumeContent();
    }
</code></pre>
<p>Eventually test cases for all supported IoT Platform Resources should be implemented. But since this is intended to be incomplete sample code for the purposes of enhancing the OSLC Developer Guide, these details are not covered.</p>
</div></section></div><a role="button" aria-label="Toggle Navigation" data-toggle-class="primary-nav-is-open" data-toggle-target="body" class="close-off-canvas"></a></main></div><footer class="footer"><p>Content licensed under <a href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 US</a> | <a href="https://github.com/OSLC/developing-oslc-applications/edit/gh-pages/_harp/iotp_adaptor/junit-tests.md" target="_blank" style="font-weight: bold"><i class="fas fa-pencil-alt"></i> Edit this page</a> | <a href="https://github.com/OSLC/developing-oslc-applications/issues">Report an issue</a> | <a href="https://open-services.net/" target="_blank">Open Services for Lifecycle Collaboration</a> <i class="fas fa-external-link-alt"></i></p></footer></body><script>window.site_url = 'https://oslc.github.io/developing-oslc-applications/';</script><script src="https://oslc.github.io/developing-oslc-applications/js/oslc.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ER4THK2G7V"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ER4THK2G7V', {'anonymize_ip' : true, 'client_storage': 'none'});</script></html>