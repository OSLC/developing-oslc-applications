<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>The toolchain model</title><link rel="stylesheet" href="https://oslc.github.io/developing-oslc-applications/css/oslc.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/solid.css" integrity="sha384-QokYePQSOwpBDuhlHOsX0ymF6R/vLk/UQVz3WHa6wygxI5oGTmDTv8wahFOSspdm" crossorigin="anonymous"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/fontawesome.css" integrity="sha384-vd1e11sR28tEK9YANUtpIOdjGW14pS87bUBuOIoBILVWLFnS+MCX9T6MMf0VdPGq" crossorigin="anonymous"><script src="https://oslc.github.io/developing-oslc-applications/js/lib/modernizr.js"></script><script>// add .mustard/.no-mustard css classes
Modernizr.addTest( 'mustard', 'querySelector' in document && 'localStorage' in window && 'addEventListener' in window );

Modernizr.load([{
  test: Modernizr.mustard,
  yep: 'https://oslc.github.io/developing-oslc-applications/css/oslc_enhanced.css'
}]);

</script></head><body><header class="header"><div class="flag"><div class="image"><button title="Main menu" role="button" aria-label="Toggle Navigation" data-toggle-class="primary-nav-is-open" data-toggle-target="body" class="navburger mustard-only"><span class="navburger-line top"></span><span class="navburger-line middle"></span><span class="navburger-line bottom"></span></button></div><div class="body"><a href="https://oslc.github.io/developing-oslc-applications/" class="flag image-link"><div class="image"><img src="https://oslc.github.io/developing-oslc-applications/img/logo-new-mobile.png" class="logo-img"></div><div class="body"><span class="logo-text"><abbr title="Open Services for Lifecycle Collaboration" class="oslc-name">OSLC</abbr><br><span class="project-name">Developer Guide</span></span></div></a></div></div></header><div class="sticky-footer-body off-canvas-wrap"><nav class="nav"><div class="menu primary"><div class="item desk-up"><a href="https://oslc.github.io/developing-oslc-applications/" class="image-link"><img src="https://oslc.github.io/developing-oslc-applications/img/logo-new-big.png"><span class="logo-text"><abbr title="Open Services for Lifecycle Collaboration" class="oslc-name">OSLC</abbr><span class="project-name">Developer Guide</span></span></a></div><ul class="items"><li role="presentation" class="item"><a href="../iotp-adaptor-sample.html"><i class="fas fa-level-up-alt"></i> One level up</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/developer-guide.html">Developer Guide</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/environment-setup.html">eclipse environment setup</a></li><li role="presentation" class="item current"><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/toolchain-model.html">The toolchain model</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/code-generator.html">Generating the server code</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/exploring-the-code.html">Exploring the generated code</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/ssl-support.html">https and SSL support</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/authentication.html">Authentication</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/rootservices.html">Creating the rootservices document</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/consumer-friend.html">Connecting Servers</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/artifact-container-associations.html">Artifact Container Associations</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/dialogs.html">Updating generated dialogs</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/implement-domain-class.html">Implementing a Domain Class</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/trs-provider.html">Implementing a TRS Provider</a></li><li role="presentation" class="item "><a href="https://oslc.github.io/developing-oslc-applications/iotp_adaptor/junit-tests.html">JUnit Tests</a></li></ul><div><iframe src="https://duckduckgo.com/search.html?width=220&site=oslc.github.io/developing-oslc-applications/&prefill=Search DuckDuckGo&kn=1" style="overflow:hidden;margin:0 0 0 13px;padding:0;width:305px;height:40px;" frameborder="0"></iframe></div></div></nav><main class="main"><div class="card"><header class="header"><h1 class="title">The toolchain model</h1></header><section class="content"><div class="copy"><h1>Modeling the iotp-adaptor Toolchain</h1><ul>
<li>Domain specifications</li>
<li>Basic CRUD operations</li>
<li>Selection Dialogs</li>
<li>Creation Dialogs</li>
<li>Toolchain services</li>
</ul>
<h2>eclipse/Lyo Designer Overview</h2><p>The <a href="https://github.com/eclipse/lyo.designer/wiki">eclipse/Lyo Designer</a> is used for developing an OSLC4J provider using a code generator based on an EMF model of OSLC domain specifications. Here are some useful resources regarding OSLC, eclipse/Lyo and the ToolChain modeler.</p>
<ul>
<li><a href="https://github.com/eclipse/lyo.designer/wiki">Eclipse Lyo Designer</a> The  GitHub Repository where Lyo Designer is developed and documented</li>
<li><a href="https://github.com/eclipse/lyo.designer/wiki">Lyo Designer Documentation</a> Documentation describing how to install, create specification and toolchain models, and complete the toolchain implementation.</li>
<li><a href="https://archive.open-services.net/linked-data-and-oslc-tutorial-2015-update/">Linked Data and OSLC Tutorial</a>, 2015, Jad El-Khoury:  good overview of OSLC 2.0 but does not cover Lyo Designer</li>
<li><a href="https://www.youtube.com/watch?v=qQRZtd4EC7E&amp;t=280s">Linked Data and OSLC for Tool Interoperability - Part 1/2</a> November 2015, Jad El-Khoury</li>
<li><a href="https://www.youtube.com/watch?v=k0cOAkEWvBs">Linked Data and OSLC for Tool Interoperability - Part 2/2</a> This 2-part series doesn’t cover OSLC 3 or the code generator</li>
<li><a href="https://www.thinkmind.org/index.php?view=article&amp;articleid=alldata_2016_3_10_90030">Modeling Support for Linked Data Approach to Tool Interoperability</a> - supporting article for the Lyo Designer Toolchain code generator</li>
<li><a href="https://www.youtube.com/watch?v=nEImx_c6K5U">An OSLC4J Code Generator - Presentation &amp; Demo</a> by Jad El-Khoury, KTH - 24/02/2014 KTH, Stockholm, Sweden - does cover the code generator, but not the toolchain</li>
</ul>
<p>Jad El-Khoury maintains an adaptor that is code generated under a public repository <a href="http://git.md.kth.se:8080/scm/git/se.kth.md.iee.pub">http://git.md.kth.se:8080/scm/git/se.kth.md.iee.pub</a>; folder (\src\BugzillaAdaptor). The generator is based on the original OSLC4J Bugzilla adaptor. Relative to the reference implementation, the generator covers most features, but does not address rootservices or integration with the IBM CE apps. To access and install the BugzillaAdaptor:</p>
<ul>
<li>git clone <a href="http://git.md.kth.se:8080/scm/git/se.kth.md.iee.pub">http://git.md.kth.se:8080/scm/git/se.kth.md.iee.pub</a></li>
<li>Then import existing projects into your workspace browsing to <code>~/git/se.kth.md.iee.pub</code>. There will be four eclipse projects that can be imported from there.</li>
</ul>
<p>The toolchain code generator creates an {adapter}Manager class that has to be implemented after code generation to get, create and search domain model elements. See <a href="./exploring-the-code">Exploring the generated code</a> and <a href="./implement-domain-class">Implementing a Domain Class</a> for details.</p>
<p>The eclipse setup information at <a href="https://github.com/eclipse/lyo.designer/wiki/User-Manual-for-Domain-Specification-Modelling#eclipse-setup">Installing Lyo Designer</a> includes all the packages necessary to also run an OSLC4J application. To build the generator itself, all that is necessary is (1) Acceleo (2) EMF Facet SDK and (3) EMF - Eclipse Modeling Framework SDK (Diagram Editor for Ecore is optional). The Lyo Designer editor is a Sirius 5.x model editor.</p>
<p>Lyo Designer is based on EMF model and Acceleo code generator. Acdeleo is an eclipse project that implements the OMG MOF to Text generation (M2T) framework. M2T is the language and framework used to develop the Lyo Designer code generation templates.</p>
<h2>Overview of code generation process</h2><p>Here&#39;s a brief overview of the process for using Lyo Designer to create a toolchain model and generate the implementation.</p>
<ol>
<li>Create a new <a href="https://github.com/eclipse/lyo.designer/wiki/User-Manual-for-Domain-Specification-Modelling#create-a-modelling-project">eclipse project</a> this is ready for code generation</li>
<li>Create an adapter model</li>
<li>Define the adaptor model</li>
<li>Configure adaptor code generator</li>
<li>Generate the adaptor implementation code</li>
<li>Fill in the internal implementation of the adaptor</li>
<li>Run the adaptor</li>
</ol>
<p>The Toolchain <strong>adapter model</strong> provides starting point for creating the domain model. The <strong>code generator</strong> uses the adapter model and the M2T templates to generate the code.</p>
<p>The toolchain model is structured around the following three viewpoints:</p>
<ol>
<li><strong>Domain Specification View</strong> – To define the types of resources, their properties and relationships, according the OSLC Core Specification and the Resource Shape constraint language.</li>
<li><strong>Adapter Interface View</strong> – To design the internal details of the tool interface. Sufficient information is captured in this view, so that an almost complete interface code, which is compliant with the OSLC4J software development kit (SDK) can be generated.</li>
<li><strong>Toolchain View</strong> – To allocate resources to tools. For each tool, the set of resources being exposes and/or consumed are defined.</li>
</ol>
<h2>Install the code generator</h2><p>See <a href="./environment-setup">eclipse environment setup</a> for detailed instructions on how to install the Lyo Code Generator and Toolchain. Here&#39;s a brief summary:</p>
<ol>
<li>Install eclipse OXYGEN.3, Eclipse IDE for Java EE Developers</li>
<li>Set JAVA_HOME</li>
<li>Follow <a href="https://wiki.eclipse.org/Lyo/General_Setup_for_OSLC4J_Development">General Setup for OSLC4J development</a></li>
<li>Install the code generator using one of these eclipse update sites:<ul>
<li>released version: <a href="http://download.eclipse.org/lyo/p2/stable/">http://download.eclipse.org/lyo/p2/stable/</a></li>
<li>latest build: <a href="http://download.eclipse.org/lyo/p2/edge">http://download.eclipse.org/lyo/p2/edge</a></li>
<li>Install features (1) Lyo Code Generator and (2) Lyo Toolchain</li>
</ul>
</li>
</ol>
<h2>Using the Toolchain Modeler</h2><p>The <a href="https://github.com/eclipse/lyo.designer/wiki">Lyo Designer Documentation</a> provides details on how to install, setup and use Lyo Designer to create an adaptor model and generate the code. We won&#39;t duplicate that information here. What&#39;s included here are some notes on using the Toochain modeler, including things that are unique to iotp-adaptor, possible issues and some things that aren&#39;t yet fully documented.</p>
<ol>
<li>Don&#39;t use &quot;Application&quot; or &quot;Service&quot; as a resource name as it would conflict on import with the generated servlet name Application.java and Service.java. For Bluemix, use App and CFService.</li>
<li>The generator doesn’t deal with resource renames or deletes - the old classes from a previous generation are left. You need to delete them all and re-generate if a lot of renames were done. Also delete src/main/webapp/com*, the generated JSP pages. Its easy to see which files were recently generated by looking at their modification times in the eclipse Properties view.</li>
<li>Reused domains usually get new classes generated in each reuse instead of reusing already generated libraries. Lyo Designer does provide a way to <a href="https://github.com/eclipse/lyo.designer/wiki/User-Manual-for-Domain-Specification-Modelling#common-domains">reuse common domains</a> packages and classes.</li>
<li>Import the org.eclipse.lyo.tools.domainmodels project into your workspace from git://git.eclipse.org/gitroot/lyo/org.eclipse.lyo.tools.git</li>
<li>In your modeling project, right click on the “Project Dependencies” in the Project Explorer tree, and select “Add Model”<ol>
<li>Select “Browse Workspace”</li>
<li>Select the oslcDomainsSpecification.xml file under the org.eclipse.lyo.tools.domainmodels project. A set of standard OSLC domains are now available in your project to use, under Project Dependencies <img src="./images/Project-Dependencies.png" alt="Project Dependencies" title="Project Dependencies"></li>
</ol>
</li>
<li>In your own specification diagram, you can now drag and drop any domain under the xml tree to visually present it if needed. Use different diagrams for different domains, or the same diagram for multiple domains if you are creating a bridge ontology to integrate domains</li>
<li>In your Adaptor Models, you can also drag-drop resources to allocate them to different adaptors. It may not be intuitive when you can drag-drop resources from the “Project Explorer” tree into the diagram, but you can experiment.</li>
<li>Note also that you can also explore the OSLC models by expanding the oslcDomainsSpecification.xml file within the org.eclipse.lyo.tools.domainmodels project – just like a toolchain model – but it only contains domain specifications</li>
</ol>
<p>A <strong>ServiceProvider</strong> represents a container of managed resources and specifies the Services the server provides on those resources. A <strong>Service</strong> provides basic CRUD operations, creation factory, query capability and delegated creation and/or selection dialogs on specified OSLC domain resources. Here&#39;s some guidelines on using multiple service providers and multiple services.</p>
<ol>
<li>A service provider represents a container of resources and the provided OSLC services. Typical resource containers would be jazz.net application Project Areas, IoT Platform and IBM Cloud Organizations, LDP Containers, etc.</li>
<li>Each service provider would have separate services for each supported domain. There will often be only one. However iotp-adaptor has two since it integrated the IoT Platform and IBM Cloud domains.</li>
<li>Each service can have zero or more BasicCapability, CreationFactory, QueryCapability and/or Dialog capabilities</li>
<li>Each capability can manage zero or more resources and may specify information about the managed resources using ResourceShapes.</li>
<li>Creation and Selection Dialog can use different dialogs for different resources if they have different shapes. or you can choose to use the same dialog for all resources and edit the generated JSP files to use a selection list to select the desired resource type.</li>
<li>QueryCapability - use the same QueryCapability for all the resources in the service’s domain unless the capability is different (supports different query clauses) and therefore needs a different queryBase URI. Different QueryCapabilities could also be required to support different collections (or LDPC) in the implementation.</li>
<li>CreationFactory - Use a different CreationFactory capability for each container the service’s domain resources should be contained in.</li>
<li>Not all resources in the service’s domain will necessarily have Creation and Selection dialogs, a query capability or creation factories. Abstract resources, or resources that should only be created by some underlying domain specific tool may not expose these capabilities through OSLC.</li>
</ol>
<p>The IoT Platform organization is the iotp-adaptor service provider (like CE project area) that provides creation dialog, selection dialog, query base, and CRUD operations for IoT Platform resources managed by the organization. Organization is a good choice because it is the container of managed resources and provides role based access control permissions on those resources.</p>
<p>Similarly the IBM Cloud (formerly Bluemix) organization is the service provider for Node-RED flows.</p>
<p>Therefore there is no OSLC domain resource for IoT platform or Bluemix organizations since these are the adaptor&#39;s service providers.</p>
<p>IoT Platform DeviceTypes may have a few fixed properties, but most are defined by the application interface schamas that expose the device or thing data to applications.</p>
<p>All generated classes representing resources extend OSLC4J <strong>AbstractResource</strong>, which itself implements the IExtendedResource interface. IoT Platform and Bluemix resources are most closely aligned to OSLC Architecture Management resources. In order to allow these resources to be targets of Architecture Management links, all the linkable IoT Platform and Bluemix resources also subclass <strong>oslc_am:Resource</strong>.</p>
<h2>IoT Platform and Bluemix specification models</h2><p>The iotp-adaptor domain model is based on the IBM Watson IoT Platform and Bluemix REST APIs. The domain model represents the information we want to expose for OSLC linking from these APIs.</p>
<h3>Bluemix Domain</h3><p>The Bluemix domain models Node-RED flows and the associated Bluemix resources. We include Node-RED flows in the iotp-adaptor because it is not unusual to read data from and write data to IoT Platform devices in flows, or to implement rule actions using Node-RED flows. All Bluemix domain classes extend oslc_am:Resource and are therefore OSLC Architecture Management resources.</p>
<p><img src="./images/Bluemix-Domain.png" alt="Bluemix Domain" title="Bluemix Domain"></p>
<p>The namespace for the Bluemix domain is <a href="http://jazz.net/ns/bmx#">http://jazz.net/ns/bmx#</a>, and the preferred prefix is oslc_bmx.</p>
<ul>
<li><strong>Space</strong> represents a development space in which a solution can be developed. Spaces are often used to represent dev, test, pre-production and production lifecycle instances of the app</li>
<li><strong>CFService</strong> is a Cloud Foundry service that is provisioned in the space, and bound to the application that uses it.</li>
<li><strong>App</strong> is an IBM Cloud application and typically represents the project deliverable</li>
<li><strong>NodeREDApp</strong> is an extension of Bluemix App representing a Node-RED flow</li>
<li><strong>Flow</strong> is a particular flow tab in a Node-RED flow.</li>
</ul>
<h3>IoT Platform Domain</h3><p>The IoT Platform <a href="https://docs.internetofthings.ibmcloud.com/apis/swagger/v0002/org-admin.html">Organization Admin</a> and <a href="https://docs.internetofthings.ibmcloud.com/apis/swagger/v0002/state-mgmt.html">Information Management</a> APIs provide the foundation for defining the IoT Platform domain model.</p>
<p>Note: Due to the historical evolution of the Watson IoT Platform, there are some inconsistencies in the organization and implementation of the REST APIs:</p>
<ul>
<li>DeviceType and Device resources are defined in Organization Admin, all the other related resources are defined in Information Management</li>
<li>Device does not support a modification time, and its creation time is assumed to be its registration date</li>
<li>Resources defined in the Information Management APIs have draft versions that can be activated using the PATCH method. iotp-adaptor uses the /draft version of all these resources since it is a development time tools. Activation of draft resources can be done from the IoT Platform UI.</li>
<li>DeviceType and Device GET methods do not provide ETags, but all the resources defined in the Information Management APIs do.</li>
</ul>
<p><img src="./images/IoT-Platform-Domain.png" alt="IoT Platform Domain" title="IoT Platform Domain"></p>
<p>The namespace for the IoT Platform Domain is <a href="http://jazz.net/ns/iot#">http://jazz.net/ns/iot#</a>, and the preferred prefix is oslc_iot.</p>
<ul>
<li><strong>DeviceType</strong> represents a description of a number of similar device instances. A DeviceType references a PhysicalInterface resource which defines its interface with a physical device on the edge of the Internet. The PhysicalInteface references an EventType resource which references an event Schema resource which defines the MQTT messages payloads the device can send and receive.</li>
<li><strong>Device</strong> an instance of a DeviceType that inherits, but can override, its DeviceInfo and Metadata. Devices actually receive MQTT events at their PhysicalInterface and provide the data on their LogicalInterfaces to applications, including Node-RED flows. Note that Device is id-dependent on its DeviceType in the IoT Platform. That is, the URL that identifies the device includes the DeviceType id as an element in its pathname, and the Device id is only considered unique in the context of a specific DeviceType. This has implications for the URLs for OSLC Device services which are covered below.</li>
<li><strong>DeviceInfo</strong> provides a standard set of DeviceType and Device information defined by the Watson IoT Platform. Notice that DeviceInfo is a Local Reference Property in the specification model. This means that it is a structured property of a DeviceType and Device, but does not have a URL and is therefore not a linkable resource.</li>
<li><strong>MetaData</strong> DeviceTypes and Devices can have additional meta-data that provides additional properties in the form of simple name/value pairs that can be used to provide additional runtime information about a device. For example, MetaData could be used to specify maximum and minimum values for a Device property, Device property set-points, or any other information that is needed. MetaData is the user-defined device properties that are about the Device, not its inputs or outputs.</li>
<li><strong>MetaProperty</strong> one or more name/value pairs that make up the MetaData metaProperties of a Device.</li>
<li><strong>PhysicalInterface</strong> defines the physical interface of a device, or the input side of the device. Devices receive MQTT events at their physical interface, and the event payloads are specified by the PhysicalInterface EventType and its Schema</li>
<li><strong>EventType</strong> defines the MQTT events that a Device can receive on its PhysicalInterface with the schema defining the payload of the MQTT event.</li>
<li><strong>Schema</strong> define the structure of data for an EventType, ThingType or LogicalInterface</li>
<li><strong>LogicalInterface</strong> the output side of a Device that specifies the interface used by applications. The IBM Watson IoT Platform separates the logical and physical interfaces for a Device in order to decouple the physical device characteristics from its application interfaces so they can change independently. This reduces the impact of change in a system. The data available to applications at the LogicalInterface is defined by its schema.</li>
<li><strong>ThingType</strong> references a Schema resource that defines the input side of the ThingType. This Schema can define a composition of other device and thing types, or any data that is needed by the application.</li>
<li><strong>Thing</strong> an instance of a ThingType that has actual runtime data defined by its ThingType. Like Device, Thing is also id-dependent on its ThingType.</li>
<li><strong>Rule</strong> an IoT platform rule that has a condition that specifies when the rule will fire, and an action that will be invoked. The condition is expressed using <a href="http://jsonata.org">http://jsonata.org</a>. The action property is for future use. Currently applications can subscribe to MQTT message events produced when the rule fires (when its condition evaluates to true). Note that Rule is id-dependent on the LogicalInteface that specifies the data used in evaluating the condition. The condition expression can reference this data using the $state variable.</li>
<li><strong>DeviceTypeMapping</strong> uses <a href="http://jsonata.org">http://jsonata.org</a> to specify the mapping between a Device PhysicalInterface and any of its LogicalInterfaces.</li>
<li><strong>ThingTypeMapping</strong> uses <a href="http://jsonata.org">http://jsonata.org</a> to specify the mapping between a Thing Schema and any of its LogicalInterfaces.</li>
</ul>
<h2>Updating the Toolchain specification model</h2><p>Here are some simple guidelines on updating the Toolchain specification mode:</p>
<ul>
<li>If necessary or desired, create another specification diagram in order to visualize specific resources</li>
<li>Make some space in the domain specification element so there&#39;s room for additional resources</li>
<li>Add all the domain classes</li>
<li>For each class, add any missing properties to the domain specification first, then drag and drop onto the classes that need that property.</li>
<li>Save</li>
<li>Validate</li>
<li>Regenerate the code</li>
</ul>
<h2>OSLC Basic CRUD Capabilities</h2><p>This capability defines what IoT Platform and Bluemix resources support HTTP create, read, write and/or delete operations (i.e., HTTP POST, GET, PUT, and DELETE methods).</p>
<p>All of the OSLC services are defined in Adaptor Interfaces, in this case, and Adaptor Interface named iotp-adaptor. The iotp-adaptorModel uses a separate Adaptor Interface diagram for each service in order to make it easier to develop and update the services. The Toolchain editor by default puts all services and resources on every Adaptor Interface diagram. So you have to select and hide the model elements you don&#39;t want to be visible on any individual diagram. When you add a new resource or service to any of these adaptor interface diagrams, it will appear on all the diagrams. You&#39;ll need to edit each diagram and hide the resources you don&#39;t want to see on that diagram.</p>
<p><img src="./images/CRUD-Operations.png" alt="CRUD Operations" title="CRUD Operations"></p>
<p>Most of the resources are handled by a single BasicCapability (DeviceType, PhysicalInterface, etc.) However Device and Rule have to have a separate BasicCapability because their Instance ID can&#39;t be the default, which is the id of the resource. Device is id-dependent on its DeviceType, so its instance ID has to be <code>{typeId}/devices/{deviceId}</code>. Similarly Rule is id-dependent on the LogicalInterface that defines the data available for its condition. Its instance ID has to be <code>{logicalInterfaceId}/rules/{ruleId}</code>. In each of these cases, the JAX-RS REST service for these resources will have two parameters in their CURD operation URLs. We use these two parameters to construct the URL needed to access the resources in the IBM Watson IoT Platform. For example, here&#39;s how to specify these additional parameters for Device:</p>
<p><img src="./images/Device-BasicCapability.png" alt="Device BasicCapability" title="Device BasicCapability"></p>
<p>Another BasicCapability is created for the Bluemix Service Provider and Service for Node-RED flows.</p>
<p>Notice there&#39;s a number of resource depicted on the diagram, but not added to any BasicCapability. There are resources that might be defined in some domain, but that we are not at this time providing any HTTP method access at this time. These could represent &quot;marker&quot; resources (more on this later) or abstract resources that do not have concrete instances. Or they could be resources that we define in the domain, but don&#39;t support yet for some reason.</p>
<p>A BasicCapability can be marked Read, Delete and/or Update. These determine if REST services are created for HTTP methods GET, DELETE and PUT. POST for create services are handled separately in creation factories.</p>
<h2>OSLC Creation Factories</h2><p>Not all OSLC resources are supported by creation factories since they already have browser based editors that are more appropriate for creating resources in the Watson IoT Platform dashboard. But these are provided for scripting creation using OSLC if needed.</p>
<p><img src="./images/Creation-Factories.png" alt="Creation Factories" title="Creation Factories"></p>
<p>Each resource has its own creation factory in order to specify the queryBase URL. For example, DeviceTypeCreationFactory can create instances of DeviceType with Creation URI: <code>devicetype</code>. That means the URI for the HTTP POST method to create DeviceType resources would look something like: <code>http://localhost:8080/iotp/services/iotp/rhu3zv/resources/devicetype</code> where rhu3zv is the name of the service provider, in this case, the organization ID for the Watson IoT Platform.</p>
<p><img src="./images/DeviceType-Creation-Factory.png" alt="DeviceType Creation Factory" title="DeviceType Creation Factory"></p>
<p>Notice there are no creation factory services for the Bluemix Service Provider. This is because we threat Bluemix Space and NodeREDApp as resources that must be created using IBM Cloud UI.</p>
<p>However, there is issue for Device, Thing and Rule creation factories (and query capabilities). These all need additional URI parameters for id-dependent components: DeviceType, ThingType and LogicalInterface respectively. For the BasicCapability CRUD operations, we could include these ID components as additional parameters in the Instance ID property as shown above. However, this does not work for creation factories as the Creation URI property cannot have additional path parameters.</p>
<p>As Lyo Designer is currently designed, The initial construction of the ServiceProviderCatalog expects a fixed set of ServiceProviders and its Services. Therefore additional URI parameters such as typeId have no value is at service registration that can be resolved. This maybe makes sense as an initial set. But that does not mean that one cannot update the set of Service Providers and services dynamically.</p>
<p>However, there is a simple work around in this case. The Watson IoT Platform REST API design for these resources have a somewhat odd implementation pattern we can exploit to work around this situation. If you look at the <a href="https://docs.internetofthings.ibmcloud.com/apis/swagger/v0002/org-admin.html#!/Device_Configuration/get_device_types_typeId_devices_deviceId">Organization Administration</a> REST API and expand the GET method for Device Configuration, you can see the GET method requires the device type id in the URL: <code>GET /device/types/{typeId}/devices/{deviceId}</code>, this is what me mean by the device being id-dependent on its device type. But the model schema for Device shows that the typeId is also a property of the Device. We can use this property to construct the URL for accessing the Device from the IoT Platform in our implementation, and don&#39;t need to include it in the URL path.</p>
<p>This is not a general solution to this problem, only something that works because of a somewhat unique design of the Watson IoT Platform REST APIs. Some other options that could be considered, but that have not yet been tried are:</p>
<ol>
<li>Define a new “DeviceType” ServiceProvider, and move the DeviceCreationFactory under it. This would require the CE4IoTConnectorManager:getServiceProviderInfos() to be dynamic since device types could be added anytime.</li>
<li>Set one value of the {typeId} parameter in the paramterValueMap, in the method ServiceProviderCatalogSingleton:initServiceProviders. This results in registering single CreationFactory in the ServiceProviderCatalog, Service Provider and Service, even though there are many. Hoever, REST requests with the varying {typeId} will be handled just fine by Jax-RS.</li>
</ol>
<h2>OSLC Creation Dialogs</h2><p>Like CreationFactories, not all OSLC resources have creation dialogs, only the ones we wish to support creation of new IoT Platform resources when creating links from CE tools.</p>
<p>While it is possible to use a different CreationDialog capability for each resource, and this would generate a separate JSP page for each resource, this turns out to be less practical for many resources. The reason is that the Continuous Engineering jazz.net applications do not provide any means of selecting a specific resource type from their creation dialogs.</p>
<p>For example, here&#39;s the dialog RDNG uses to create an implementedBy link from a Requirement to an IoT Platform resource. If we select create a new, there&#39;s no way for RDNG to say what kind of IoT Platform resource to create, and therefore no way to specify which creation dialog to get.</p>
<p>An easy way to solve this is to provide only a single creation dialog, and add an HTML select element to select the kind of resource to create in the iotp-adaptor creation dialog itself.</p>
<pre><code>  &lt;body style=&quot;padding: 10px;&quot;&gt;
  Type: &lt;select id=&quot;selectType&quot;&gt;
      &lt;option value=&quot;device&quot;&gt;Device&lt;/option&gt;
      &lt;option value=&quot;devicetype&quot;&gt;DeviceType&lt;/option&gt;
      &lt;option value=&quot;thing&quot;&gt;Thing&lt;/option&gt;
      &lt;option value=&quot;thingtype&quot;&gt;ThingType&lt;/option&gt;
      &lt;option value=&quot;logicalinterface&quot;&gt;LogicalInterface&lt;/option&gt;
      &lt;option value=&quot;physicalinterface&quot;&gt;PhysicalInterface&lt;/option&gt;
      &lt;option value=&quot;eventtype&quot;&gt;EventType&lt;/option&gt;
      &lt;option value=&quot;schema&quot;&gt;Schema&lt;/option&gt;
      &lt;option value=&quot;rule&quot;&gt;Rule&lt;/option&gt;
  &lt;/select&gt;</code></pre><p>We&#39;ll cover this in more detail when looking at the <a href="./exploring-the-code">generated code</a>. For now, we&#39;ll have Lyo Designer just generate a single creation dialog for generic resources, and edit the generated dialogs to add the type select element and the code for processing it.</p>
<p><img src="./images/Creation-Dialogs.png" alt="Creation Dialogs" title="Creation Dialogs"></p>
<p>Notice that there is no creation dialog for the Bluemix Service Provider&#39;s Services. This is because Space and NodeREDApp are read-only in our design. This is because the mechanics of creating spaces and Node-RED flows is somewhat complex and better handled directly by IBM Cloud.</p>
<h3>Marker Types</h3><p>There is another curious thing about the the creation dialog: its used to create instances of IoT Platform resources. But the adapter interface model shows the ResourceCreation dialog is used to create oslc_cm:ChangeRequest, <code>oslc_rm:Requirement</code> and <code>oslc_am:Resource</code>. Why is that?</p>
<p>This is done in oder to allow IoT Platform resources to be the target of link types that are supported by the jazz.net apps: RTC, RDNG, RQM and RDM. This will require some explanation.</p>
<p>All these tools use jazz.net project areas as the source of their service providers. Each project area can be configured with artifact containers that represent services providers accessible from the same or friend servers. Each artifact container or service provider can specify creation dialogs for its resources, including iotp-adaptor.</p>
<p>The link types supported by the jazz.net apps are based on the OSLC domain specifications (RM, CM, AM and QM), and are extended by the vocabularies defined in the <a href="http://jazz.net/ns">http://jazz.net/ns</a> namespaces. The jazz.net apps in most cases have fixed expectations about the resources they expose through OSLC to other servers, and the link types and target resource types they are expecting through artifact container associations from other friend servers.</p>
<p>For example, RDNG supports Requirement and RequirementCollection OSLC RM resources, and Module resources as a jazz.net extension. RDNG also supports a set of link types defined by the OSLC domain specifications and the jazz.net extensions. So when RDNG has an artifact container association to say a server that provides OSLC access to OSLC change management resources, it will enable the creation of implementedBy links between requirements and change request resources. Similarly RDNG will support references links to resources in artifact container associations with OSLC requirements management resources. And similarly again, RDNG supports a number of link types to resources in artifact container associations with OSLC architecture management resources as defined in <a href="http://jazz.net/ns/dm/linktypes#">http://jazz.net/ns/dm/linktypes#</a>.</p>
<p>RDNG, and many of the other jazz.net tools, do support custom artifact types and link types. But RDNG does not at this time support extensible link types across server boundaries, it only supports them within a project area, or with resources in other requirements management project areas on the same server that have exactly the same custom link types. As a result, RDNG would not know anything about link types and resources defined in the IoT Platform and/or Bluemix domains, it would only support the link types defined in <a href="http://jazz.net/ns/dm/linktypes#">http://jazz.net/ns/dm/linktypes#</a> since all the linkable resources in the IoT Platform and Bluemix domains extend oslc_am:Resource.</p>
<p>So we specified the resource that can be created by the iotp-adaptor creation dialog to be oslc_rm:Requirement, oslc_cm:ChangeRequest and oslc_am:Resource to &quot;mark&quot; the creation dialog to allow RDNG and other jazz.net apps to recognize the creation dialog as a valid &quot;picker&quot; for resources that are acceptable as the targets for app supported link types.</p>
<p>Now you might ask, why wasn&#39;t oalc_am:Resource enough? That would have provided a pretty rich set of link types defined in <a href="http://jazz.net/ns/dm/linktypes#">http://jazz.net/ns/dm/linktypes#</a> that are already supported by the jazz.net apps. And the IoT Platform and Bluemix resources are certainly a lot more like AM resources than they are requirements or change requests.</p>
<p>The reason is an artifact of the iotp-adaptor design. iotp-adaptor is an OSLC adapter that follows what we might call the &quot;pure facade&quot; adapter. That is, iotp-adaptor node no user management and has no persistence of its own, this just an OSLC facade on Watson IoT Platform and IBM Cloud, delegating everything these components.</p>
<p>What this means is that iotp-adaptor does not have any means of storing links, partly because it has no storage capability of its own, and the Watson IoT Platform and IBM Cloud don&#39;t (easily) provide extensibility features that could be used to store these links. So all the links have to stored in the CE jazz.net apps.</p>
<p>This constraint has implications because of the link ownership implementations of the CE jazz.net tools. For example, RDNG can create links to architecture management resources in Rational Design Manager (RDM). However, it expects RDM to actually store the link. The sequence goes like this:</p>
<ol>
<li>A user opens a requirement, clicks on the Links tab, and chooses the menu item to create a new Implemented by Architectural Element link.</li>
<li>RDNG displays its link creation dialog with a dropdown list of all the artifact containers in its project area&#39;s artifact container associations that provide resources that can be the target of that link type, in this case RDM project areas</li>
<li>The user selects an RDM project area (or artifact container/service provider)</li>
<li>RDNG uses the SerivceProvderCatalog that it discovered from the rootservices document that was provided with the friend was created to the RDM server to discover the ServiceProviders and Services of that project area</li>
<li>RDNG finds all the creation dialogs defined in the Services, and checks to make sure the Dialog&#39;s oslc:resourceType is an oslc_am:Resource. If so, it does a GET on the oslc:dialog URL and displays RDM&#39;s creation dialog in an iframe inside its dialog. If not it gives a warning that the artifact container does not support any pickers.</li>
<li>The user selects or creates (the process is similar for both) the AM resource to link to and presses OK</li>
<li>RDNG gets a Window message with the URL of the selected or created resource. RDNG does a get on that resource, adds an assertion of the incoming link type (e.g., resource implementsRequirement requirement instead of requirement implementedByArchitecturalElement) to the oslc_am:Resource</li>
<li>RDNG does a PUT to update the resource in RDM so that the link is actually stored in RDM.</li>
</ol>
<p>So you see why having IoT Platform resources be oslc_am:Resource wasn&#39;t enough, because its not possible for iotp-adaptor to store the link. It can do the PUT, but the link will be lost if its not stored in the jazz.net app.</p>
<p>We exploit this in the following ways. RDNG will store a backlink to an oslc_cm:ChangeManagement resources, so we can use this to store the link to an IoT Platform resource. But to do this, the IoT Platform resource must masquerade as an oslc_cm:ChangeRequest, otherwise RDNG will report that the artifact container does not provide any pickers for CM resources. We do this by &quot;marking&quot; the creation and selection dialogs to indicate their oslc:resourceType is an oslc_cm:ChangeRequest, and we &quot;mark&quot; each of the IoT Platform resources to indicate they have rdf:type oslc_cm:Resouce. This is surely a hack, but there you go, we sometimes do what we have to do. The alternative would be to add storage to CE4IoTConnecgtor and we wanted to see how far we could go without doing that.</p>
<p>RDNG will store oslc:references links to oslc_rm:Requirement resources, so we also mark the creation and selection dialogs, and rdf:type with oslc_rm:Requirement.</p>
<p>This also allows RTD and RQM to be able to link to IoT Platfom resources because both of those tools can link to requirements and/or change requests and can store the links.</p>
<p>Now this approach doesn&#39;t work if the project areas are enabled for global configuration management. This is because RDNG can no longer store the backlink to a change request. But that&#39;s ok for now since the IoT Platform resources aren&#39;t versioned enabled (yet) and therefore couldn&#39;t be configuration contributing. We are still exploring how iotp-adaptor might be made config-aware and still not store any links. But that will be a future consideration when eclipse/Lyo OSLC4J and Lyo Designer become config aware.</p>
<p>Now its clear that this approach is limited, requires a lot of knowledge about the specific link types, acceptable target resource types, and storage implementation details of the CE jazz.net applications. This results in some coupling between the CE jazz.net apps, and iotp-adaptor. We can see the negative effect of this coupling because the solution breaks if the project areas are config enabled. But this is not an atypical approach to doing integrations and configuration management aside, the coupling is actually pretty loose.</p>
<h2>OSLC Selection Dialogs</h2><p>There are two selection dialogs, one for IoT Platform resources, and one for Bluemix resources. The same selection dialog is used for all IoT Platform resources, and only the top-level resources are selectable. This is because similar to the creation dialog, we use an HTML select element in the selection dialog to make it easier for users to specify the types of things they want to find and link to.</p>
<p><img src="./images/Selection-Dialogs.png" alt="Selection Dialogs" title="Selection Dialogs"></p>
<p>The selection dialog uses the same technique as the creation dialog to mark the dialogs with marker types to enable the creation of links from the CE jazz.net apps to IoT Platform resources.</p>
<h2>OSLC Query Capability</h2><p>This diagram defines the query capability service for each resource that can be queried.</p>
<p><img src="./images/Query-Capability.png" alt="Query Capability" title="Query Capability"></p>
<p>The current implementation does not support the OSLC query capability. Rather the &quot;query&quot; is just a Java regular expression matching the dcterms:title of the resource. A future version might implement OSLC query if there is sufficient need.</p>
<h2>iotp-adaptor Toolchain</h2><p>The final part of the adaptor model is the iotp-adaptor Toolchain diagram. A Toolchain diagram defines the OSLC client and server applications that will be generated that consume and provide OSLC domain resources using the defined services. Each adaptor interface of the toolchain defines an OSLC server that can provide and consume resources. For iotp-adaptor, like most OSLC adapters, there is only one adaptor interface, and it only provides managed resources, it doesn&#39;t consume any from any other OSLC server.</p>
<p><img src="./images/iotp-adaptor.png" alt="iotp-adaptor" title="iotp-adaptor"></p>
<p>The Java Class Base Namespace <code>com.ibm.oslc.adaptor.iotp</code> provides the package name to be used to contain all the generated Java classes.</p></div></section></div><a role="button" aria-label="Toggle Navigation" data-toggle-class="primary-nav-is-open" data-toggle-target="body" class="close-off-canvas"></a></main></div><footer class="footer"><p>Content licensed under <a href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 US</a> | <a href="https://github.com/OSLC/developing-oslc-applications/edit/gh-pages/_harp/toolchain-model.md" target="_blank" style="font-weight: bold"><i class="fas fa-pencil-alt"></i> Edit this page</a> | <a href="https://github.com/OSLC/developing-oslc-applications/issues">Report an issue</a> | <a href="https://open-services.net/" target="_blank">Open Services for Lifecycle Collaboration</a> <i class="fas fa-external-link-alt"></i></p></footer></body><script>window.site_url = 'https://oslc.github.io/developing-oslc-applications/';</script><script src="https://oslc.github.io/developing-oslc-applications/js/oslc.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-24416914-3', 'oslc.github.io');
ga('send', 'pageview');</script></html>