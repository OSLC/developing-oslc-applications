<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Exploring the generated code</title><link rel="stylesheet" href="http://oslc.github.io/developing-oslc-applications/css/oslc.css"><script src="http://oslc.github.io/developing-oslc-applications/js/lib/modernizr.js"></script><script>// add .mustard/.no-mustard css classes
Modernizr.addTest( 'mustard', 'querySelector' in document && 'localStorage' in window && 'addEventListener' in window );

Modernizr.load([{
  test: Modernizr.mustard,
  yep: 'http://oslc.github.io/developing-oslc-applications/css/oslc_enhanced.css'
}]);

</script></head><body><header class="header"><div class="flag"><div class="image"><button title="Main menu" role="button" aria-label="Toggle Navigation" data-toggle-class="primary-nav-is-open" data-toggle-target="body" class="navburger mustard-only"><span class="navburger-line top"></span><span class="navburger-line middle"></span><span class="navburger-line bottom"></span></button></div><div class="body"><a href="http://oslc.github.io/developing-oslc-applications/" class="flag image-link"><div class="image"><img src="http://oslc.github.io/developing-oslc-applications/img/logo-old-50px.png" class="logo-img"></div><div class="body"><span class="logo-text"><abbr title="Open Services for Lifecycle Collaboration" class="oslc-name">OSLC</abbr><br><span class="project-name">Developer Guide</span></span></div></a></div></div></header><div class="sticky-footer-body off-canvas-wrap">     <nav class="nav"><div class="menu primary"><div class="item desk-up"><a href="http://oslc.github.io/developing-oslc-applications/" class="image-link"><img src="http://oslc.github.io/developing-oslc-applications/img/logo-old-big.gif"><span class="logo-text"><abbr title="Open Services for Lifecycle Collaboration" class="oslc-name">OSLC</abbr><span class="project-name">Developer Guide</span></span></a></div><ul class="items"><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/developer-guide.html">Developer Guide</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/environment-setup.html">eclipse environment setup</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/toolchain-model.html">The toolchain model</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/code-generator.html">Generating the server code</a></li><li role="presentation" class="item current"><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/exploring-the-code.html">Exploring the generated code</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/ssl-support.html">https and SSL support</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/authentication.html">Authentication</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/rootservices.html">Creating the rootservices document</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/consumer-friend.html">Connecting Servers</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/artifact-container-associations.html">Artifact Container Associations</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/dialogs.html">Updating generated dialogs</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/implement-domain-class.html">Implementing a Domain Class</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/trs-provider.html">Implementing a TRS Provider</a></li><li role="presentation" class="item "><a href="http://oslc.github.io/developing-oslc-applications/iotp_adaptor/junit-tests.html">JUnit Tests</a></li><li role="presentation" class="item"><a href="http://open-services.net/">open-services.net</a></li></ul></div></nav><main class="main"><div class="card"><header class="header"><h1 class="title">Exploring the generated code</h1></header><section class="content"><div class="copy"><h1>Exploring the generated code</h1><p>This section explores the iotp-adaptor code generated by Lyo Designer, and provides details on completing the implementation. </p>
<h2>Overall architecture and packaging</h2><p>The Lyo Designer code generator generates code into a given folder, it does not generate a complete JEE project. So before using Lyo Designer to generate the code, you need to create the folder and overall structure of a JEE dynamic web application. See <a href="https://github.com/eclipse/lyo.designer/wiki/User-Manual-for-Domain-Specification-Modelling#create-a-modelling-project">eclipse project</a> for details on how to setup a suitable eclipse project.</p>
<p>Here&#39;s the overall structure of the iotp-adaptor eclipse project:</p>
<p><img src="./images/Generated-project.png" alt="iotp-adaptor project" title="iotp-adaptor project"></p>
<h2>Web application and servlets</h2><p>The iotp-adaptor is a JEE dynamic web application that utilizes the eclipse/Lyo OSLC4J SDK. Much of the web application is provided through some key servlets:</p>
<ul>
<li>Application - The javax.ws.rs.Application used by the Wink RestServlet to provide the REST services</li>
<li>BmxServiceProvidersFactory - servlet providing the IBM Cloud (formerly Bluemix) service providers, corresponding to the IBM Cloud organizations</li>
<li>IotpServiceProvidersFactory - servlet providing the IBM Watson IoT Platform service providers, corresponding to the Watson IoT Platform organizations</li>
<li>ServiceProviderCatalogSingleton - servlet providing the service provider catalog that includes the IoT Platform and Bluemix service providers</li>
<li>ServletListner - handles events in the web application container</li>
<li>RootServicesService - provides the rootservices resource needed to integrate iotp-adaptor with the jazz-apps.</li>
</ul>
<p>The web application is defined in the web.xml deployment descriptor. There are a few application parameters that should be set in the deployment descriptor including the URL scheme, port and application base URL.</p>
<pre><code>  &lt;context-param&gt;
    &lt;description&gt;Scheme used for URI when registering ServiceProvider.  Can be overridden by System property of the same name.&lt;/description&gt;
    &lt;param-name&gt;com.ibm.oslc.adaptor.iotp.servlet.scheme&lt;/param-name&gt;
    &lt;param-value&gt;https&lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;context-param&gt;
    &lt;description&gt;Base URI for the adaptor.&lt;/description&gt;
    &lt;param-name&gt;com.ibm.oslc.adaptor.iotp.servlet.baseurl&lt;/param-name&gt;
    &lt;param-value&gt;https://rlia4iot.raleigh.ibm.com:9443&lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;context-param&gt;
    &lt;description&gt;Port used for URI when registering ServiceProvider.  Can be overridden by System property of the same name.&lt;/description&gt;
    &lt;param-name&gt;com.ibm.oslc.adaptor.iotp.servlet.port&lt;/param-name&gt;
    &lt;param-value&gt;9443&lt;/param-value&gt;
  &lt;/context-param&gt;
</code></pre><p>OSLC4J and therefore iotp-adaptor, use JAX-RS and Apache Wink to implement RESTful web services. These elements in the web.xml deployment descriptor establish the base web application.</p>
<pre><code>  &lt;servlet&gt;
    &lt;description&gt;JAX-RS Tools Generated - Do not modify&lt;/description&gt;
    &lt;servlet-name&gt;JAX-RS Servlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.wink.server.internal.servlet.RestServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
      &lt;param-value&gt;com.ibm.oslc.adaptor.iotp.servlet.Application&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
</code></pre><p>All of the generated web services are mapped to the JAX-RS servlet using the /services/* URL pattern:</p>
<pre><code>  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;JAX-RS Servlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/services/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
</code></pre><p>In order to integrate with the CE jazz-apps, it iotp-adaptor needs to include a rootservices document. This is added to the web.xml file using the RootServicesService servlet.</p>
<pre><code>  &lt;servlet&gt;
    &lt;servlet-name&gt;RootServicesService&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.ibm.oslc.adaptor.iotp.impl.RootServicesService&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;RootServicesService&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/rootservices&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
</code></pre><p>In order to support authentication, all service requests are directed through the CredentialsFilter. This servlet filter handles all the authorization challenges by delegating to the Watson IoT Platform. I also handles an OAuth1.0a authentication requests that come from the OSLC4J oauth-webapp.</p>
<pre><code>  &lt;filter&gt;
    &lt;display-name&gt;CredentialsFilter&lt;/display-name&gt;
    &lt;filter-name&gt;CredentialsFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.ibm.oslc.adaptor.iotp.impl.CredentialsFilter&lt;/filter-class&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;CredentialsFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/services/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;servlet&gt;
</code></pre><h3>Application.java</h3><p>There are some additional application features that are added to the com.ibm.oslc.adaptor.iotp.servlet.Application class. These web application features include:</p>
<ul>
<li>OAuth1.0a authentication using OSLC4J oauth-webapp</li>
<li>The iotp-adaptor TRS provider service</li>
<li>Swagger.io services</li>
</ul>
<pre><code>        // Start of user code Custom Resource Classes
        // OAuth service and Swagger.io service
        try {
            RESOURCE_CLASSES.add(Class.forName(&quot;org.eclipse.lyo.server.oauth.webapp.services.ConsumersService&quot;));
            RESOURCE_CLASSES.add(Class.forName(&quot;org.eclipse.lyo.server.oauth.webapp.services.OAuthService&quot;));
            RESOURCE_CLASSES.add(io.swagger.jaxrs.listing.ApiListingResource.class);
            RESOURCE_CLASSES.add(io.swagger.jaxrs.listing.SwaggerSerializers.class);
        } catch (ClassNotFoundException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        // TRS service    
        RESOURCE_CLASSES.add(TrackedResourceSetService.class);

         // trigger Jena init
         ModelFactory.createDefaultModel();
         // force plain XML writer
         RDFWriterFImpl.alternative(null);
        // End of user code
</code></pre><p>The iotp-adaptor also provides support for accessing a Swagger.io interface for the JAX-RS RESTful web services using the @Api annotation. See <a href="https://wiki.eclipse.org/Lyo/creating_OSLC4J_project#Access_the_Swagger_Documentation">OpenApi/Swagger Support</a> for how to configure your OSLC adaptor for Swagger.io support.</p>
<p>These additional services are available at the following URLs:</p>
<ul>
<li>OAuth Administration: <code>https://rlia4iot.raleigh.ibm.com:9443/iotp/services/oauth/admin</code>, you can manage consumer keys here.</li>
<li>TRS Provider: <a href="https://rlia4iot.raleigh.ibm.com:9443/iotp/services/trs">https://rlia4iot.raleigh.ibm.com:9443/iotp/services/trs</a></li>
<li>Swagger.io: <a href="https://rlia4iot.raleigh.ibm.com:9443/iotp/swagger-ui/">https://rlia4iot.raleigh.ibm.com:9443/iotp/swagger-ui/</a></li>
</ul>
<h2>Services</h2><p>Most of the REST services are defined in a set of generate services classes.</p>
<ul>
<li>BluemixService - provides the basic CRUD and query REST services on Bluemix resources (e.g., Node-RED flows)</li>
<li>BluemixSerivceProviderServices - provides the REST services for the Bluemix ServiceProviders (based on the organizations)</li>
<li>IoTPlatformService - provides the basic CRUD and query REST services on IoT Platform resources (e.g., DeviceType, Device, etc.)</li>
<li>IoTPlatformSerivceProviderServices - provides the REST services for the IoT Platform ServiceProviders (based on the organizations)</li>
<li>ResourceShapeService - provides the REST services for accessing all the domain class resource shapes</li>
<li>ServiceProviderCatalogService - provides the REST service to access the ServiceProviderCatalog which includes the Bluemix and IoT Platform ServiceProviders.</li>
</ul>
<h2>Resource classes</h2><p>All the iotp-adaptor resources are generated into the com.ibm.oslc.adaptor.iotp.resources package. These classes provide the interface and implementation of all the bmx and iotp domain classes. See <a href="./implement-domain-class">Implementing a Domain Class</a> for details on what additional development needs to be done to complete the domain class implementations.</p>
<h2>The CE4IoTConnectorManager</h2><p>The CE4IoTConnectorManager class is where most of adaptor code is implemented. The stubbed methods generated in this class define the low-level CRUD operations used to implement the REST services. There is a set of method created for each domain class to create, get, update, delete and query instances of that class. See <a href="./implement-domain-class">Implementing a Domain Class</a> for details on how these methods are implemented using the IoT Platform and Bluemix REST APIs.</p>
<h2>Other Implementation Classes</h2><p>There are a number of other classes that implement capabilities needed by CE4IoTConnectorManager. These are summarized briefly here. See the source code for details.</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>BmxServiceproviderInfo</td>
<td>Specifies the information needed in a Bluemix service provider: its name, id, and organization id.</td>
</tr>
<tr>
<td>IotpServiceproviderInfo</td>
<td>Specifies the information needed in a IoT Platform service provider: its name, id, platform base, api version, etc.</td>
</tr>
<tr>
<td>Credentials</td>
<td>provides the user&#39;s credentials, their name and password</td>
</tr>
<tr>
<td>CredentialsFilter</td>
<td>the servlet filter class that handles user and OAuth authentication</td>
</tr>
<tr>
<td>HttpUtils</td>
<td>Provides some HTTP utilities that facilitate user authorization including getting credentials and sending unauthorized responses</td>
</tr>
<tr>
<td>IoTPAPIImpelementation</td>
<td>Implements methods to create service provider info instances (described above) from the Bluemix and IoT platform organizations the user is a member of</td>
</tr>
<tr>
<td>IoTPClient</td>
<td>provides a minimal Java API for logging into the Watson IoT Platform and doing CRUD operations on platform resources using the IoT Platform REST APIs.</td>
</tr>
<tr>
<td>RootServicesService</td>
<td>A servlet that implements the rootservices resource needed to integrate with the IBM jazz-apps</td>
</tr>
</tbody>
</table></div></section></div><a role="button" aria-label="Toggle Navigation" data-toggle-class="primary-nav-is-open" data-toggle-target="body" class="close-off-canvas"></a></main></div><footer class="footer"><p>All content <a href="http://creativecommons.org/licenses/by/3.0/us/")>Creative Commons Attribution 3.0 US</a></p><p><a href="https://github.com/OSLC/developing-oslc-applications">Github</a> <a href="https://github.com/OSLC/developing-oslc-applications/issues">Issues</a> <a href="http://open-services.net">OSLC Home</a></p></footer></body><script>window.site_url = 'http://oslc.github.io/developing-oslc-applications/';</script><script src="http://oslc.github.io/developing-oslc-applications/js/oslc.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-24416914-3', 'oslc.github.io');
ga('send', 'pageview');</script></html>